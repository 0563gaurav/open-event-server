{% extends 'admin/base1.html' %}
{% import 'admin/lib.html' as lib with context %}

{% macro extra() %}
  <input name="_continue_editing" type="submit" class="btn btn-default" value="{{ _gettext('Save and Continue') }}" />
{% endmacro %}

{% block head %}
    {{ super() }}
    {{ lib.form_css() }}
{% endblock %}

{% block body %}
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <div class="well bs-component">

              <h2>{{ admin_view.name }}</h2>
              <div class="row">
                  <div class="col-md-6">
                      {% call lib.form_tag(form) %}
                          {{ lib.render_form_fields(form, form_opts=form_opts) }}
                          {{ lib.render_form_buttons(cancel_url, extra()) }}
                      {% endcall %}
                  </div>
                  <div class="col-md-6">
                      <div id="floating-panel">
                      <input id="address" type="textbox" value="Sydney, NSW">
                      <input id="submit" type="button" value="Geocode" onclick="saveAddress()">
    </div>
			<div id="map" style="width:400px; height:300px"></div>
                  </div>
              </div>
        </div>
    </div>
    <div class="col-md-2"></div>
    <!-- bring in the google maps library -->
     <script>
function initMap() {
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 8,
    center: {lat: -34.397, lng: 150.644}
  });
  var geocoder = new google.maps.Geocoder();

  document.getElementById('submit').addEventListener('click', function() {
    geocodeAddress(geocoder, map);
  });
}

function saveAddress(){
		var address = document.getElementById('address').value;
	document.getElementById('location_name').value=address;
}

function geocodeAddress(geocoder, resultsMap) {
  var address = document.getElementById('address').value;
  geocoder.geocode({'address': address}, function(results, status) {
    if (status === google.maps.GeocoderStatus.OK) {
      resultsMap.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
        map: resultsMap,
        position: results[0].geometry.location
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiXdFK2gtVMIHB890Nxu5CKNUTbQwQzo0&signed_in=true&callback=initMap"
        async defer></script>
{% endblock %}

{% block tail %}
  {{ super() }}
  {{ lib.form_js() }}
{% endblock %}
