{% macro track_entry(track=None, remove=false, empty=False) %}
    <div class="track-holder">
        <div class=" col-sm-5 form-group">
            <input type="text" class="form-control" name="tracks[name]" placeholder="Name" required="required"
                   value="{{ track.name | default('Track 1') if not empty else '' }}">
        </div>

        <div class="col-sm-7 input-group form-group">
            <div class="input-group colorpicker-component"  id="color">
                <input type="text" value="{{ track.color | default('#7B1FA2') }}"
                       class="form-control color-picker-input"
                       placeholder="Color"
                       required="required"
                       name="tracks[color]" title="track-color"/>
                <span class="input-group-addon"><i></i></span>
            </div>
        <span class="input-group-btn">
            {% if remove %}
                <button type="button" class="btn btn-danger remove-tracks">-</button>
            {% else %}
                <button type="button" class="btn btn-primary add-tracks">+</button>
            {% endif %}
        </span>
        </div>
    </div>

{% endmacro %}

{% macro microlocation_entry(microlocation=None, remove=false, empty=False) %}
    <div class="microlocation-holder">
        <div class="col-xs-5 form-group">
            <input type="text" class="form-control" required="required" name="rooms[name]" placeholder="Name"
                   value="{{ microlocation.name | default('Room 1') if not empty else '' }}">
        </div>

        <div class="col-xs-7 input-group form-group">
            <div class="input-group">
                <input type="number" class="form-control" name="rooms[floor]"
                       placeholder="Floor"
                       title="rooms-floor"/>
                            <span class="input-group-btn">
                        {% if remove %}
                            <button type="button" class="btn btn-danger remove-rooms">-</button>
                        {% else %}
                            <button type="button" class="btn btn-primary add-rooms">+</button>
                        {% endif %}
                        </span>

            </div>
        </div>
    </div>
{% endmacro %}

{% macro session_type_entry(session_type=None, remove=false, empty=False) %}
    <div class="session-type-holder">
        <div class="col-xs-5 form-group">
            <input type="text" class="form-control" required="required" name="session_type[name]" placeholder="Name"
                   value="{{ session_type.name | default('Talks') if not empty else '' }}">
        </div>

        <div class="col-xs-7 input-group form-group">
            <input type="text" required="required" class="form-control session-length" name="session_type[length]" placeholder="Length (HH.MM)"
                   value="{{ session_type.length | default(0.30, true) }}">
            <span class="input-group-btn">
                {% if remove %}
                    <button type="button" class="btn btn-danger remove-session-type">-</button>
                {% else %}
                    <button type="button" class="btn btn-primary add-session-type">+</button>
                {% endif %}
            </span>
        </div>
    </div>
{% endmacro %}

<div id="step-3" class="wizard_content" style="display: block;">
    <div class="col-md-10 col-md-push-1">
        <div class="row">
            <div class="col-md-4 tracks">
                <h2 class="label-header">Tracks</h2>
                {% if tracks %}
                    {% for track in tracks %}
                        {{ track_entry(track, true) }}
                    {% endfor %}
                    {{ track_entry(empty=True) }}
                {% else %}
                    {{ track_entry() }}
                {% endif %}
            </div>
            <div class="col-md-4 rooms">
                <h2 class="label-header">Rooms</h2>
                {% if microlocations %}
                    {% for microlocation in microlocations %}
                        {{ microlocation_entry(microlocation, true) }}
                    {% endfor %}
                    {{ microlocation_entry(empty=True) }}
                {% else %}
                    {{ track_entry() }}
                {% endif %}
            </div>
            <div class="col-md-4 session-types">
                <h2 class="label-header">Session Types</h2>
                {% if session_types %}
                    {% for session_type in session_types %}
                        {{ session_type_entry(session_type, true) }}
                    {% endfor %}
                    {{ session_type_entry(empty=True) }}
                {% else %}
                    {{ track_entry() }}
                {% endif %}
            </div>

        </div>

    </div>
</div>
<script>
    $(function () {
        $('.colorpicker-component').colorpicker();

        $(".session-length").timepicker({
            'timeFormat': 'H.i'
        });

    });


    var $wizard = $(".form_wizard");
    var counter = 0;

    $(document).on("click", '.add-session-type', function () {
        var $element = $($(".session-type-holder")[0]).clone();
        $element.find("input").val('').attr("value", "");
        $element.find(".add-session-type").addClass("remove-session-type")
                .removeClass("add-session-type")
                .removeClass("btn-primary").addClass("btn-danger").text("-");

        $element.find(".session-length").timepicker({
            'timeFormat': 'G.i'
        });

        $('.session-types').append($element);
        $wizard.smartWizard('fixHeight');
    });

    $(document).on("click", ".remove-session-type", function () {
        $(this).closest(".session-type-holder").remove();
    });


    $(document).on("click", '.add-tracks', function () {
        counter += 1;
        var $element = $($(".track-holder")[0]).clone();
        $element.find("input:not(.color-picker-input)").val('').attr("value", "");
        $element.find(".add-tracks").addClass("remove-tracks")
                .removeClass("add-tracks")
                .removeClass("btn-primary").addClass("btn-danger").text("-");
        $element.find(".colorpicker-component").attr("id", "color" + counter);
        $('.tracks').append($element);
        $('#color' + counter).colorpicker();
        $wizard.smartWizard('fixHeight');
    });

    $(document).on("click", ".remove-tracks", function () {
        $(this).closest(".track-holder").remove();
    });

    $(document).on("click", '.add-rooms', function () {
        var $element = $($(".microlocation-holder")[0]).clone();
        $element.find("input").val('').attr("value", "");
        $element.find(".add-rooms").addClass("remove-rooms")
                .removeClass("add-rooms")
                .removeClass("btn-primary").addClass("btn-danger").text("-");

        $('.rooms').append($element);
        $wizard.smartWizard('fixHeight');
    });

    $(document).on("click", ".remove-rooms", function () {
        $(this).closest(".microlocation-holder").remove();
    });


</script>
