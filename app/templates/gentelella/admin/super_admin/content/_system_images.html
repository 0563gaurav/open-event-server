<div class="row">
    <div class="col-md-8 col-md-offset-2">
        {% for image in placeholder_images %}
            <h4>{{ image }}</h4>
            <div class="system-images" style="margin-left:50px;">
                <img src='{{ url_for("static", filename="placeholders/" + placeholder_images[image]) }}' style="width:80%; "/><br>
                <button class="btn btn-primary btn-sys" id="sys-{{ image }}" style="margin-top:10px;"> Change</button>
            </div>
            <br><hr>
        {% endfor %}
    </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="cropper-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Crop your image</h4>
            </div>
            <div class="modal-body">
                <div id="upload-cropper">

                </div>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="save-crop" class="btn btn-success">Done</button>
                </div>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="system-image-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Update Image</h4>
      </div>
      <div class="modal-body">
        <form>
            {% if event %}
                <input type="hidden" id="logo">
            {% else %}
                <input type="hidden" name="logo" id="logo">
            {% endif %}

            <div class="item form-group" id="logo-upload-group"
                 {% if event and event.logo and event.logo != '' %}style="display: none;"{% endif %}>
                <label>Logo</label><br>
                <div class="image-box">
                    <input type="file" id="logo-upload" name="logo-upload" class="image-upload-btn no-js"
                           accept="image/*"/>
                    <label class="file-label" for="logo-upload" id="logo-upload-label">
                        <i class="fa fa-4x fa-file-image-o" aria-hidden="true"></i> <br>
                        <h3>Select Logo</h3>
                    </label><br>
                </div>
                <span class="text-muted" style="color: #a2a2a2;">
                    Logo size must be less than 1MB.
                </span>
            </div>

            <div class="item form-group" id="logo-view-group"
                 {% if not event or not event.logo or event.logo == '' %}style="display: none;"{% endif %}>
                <label>Logo</label><br>
                <img src="{{ event.logo | default('', true) }}" style="width: 350px;"><br><br>
                <button type="button" class="btn btn-sm btn-default" id="remove-logo-btn">
                    <i class="fa fa-trash-o" aria-hidden="true"></i>
                    Remove
                </button>
                <br>
            </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary">Update</button>
        <button class="btn" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='admin/lib/Croppie/croppie.min.js') }}"></script>
<script type="text/javascript">
    $('.btn-sys').click(function(){
        $('#system-image-modal').modal();
    });
    function resetFormElement(e) {
        e = $(e);
        e.wrap('<form>').closest('form').get(0).reset();
        e.unwrap();
    }

    $("#logo-upload").unbind("change").on('change', function () {
        var input = this;
        if (input.files && input.files[0]) {
            if (input.files[0].size > 1048576) {
                createSnackbar("Image must be less than 1 MB in size");
                resetFormElement(input);
            } else {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#logo-upload-label").html(loadingImage);
                    $.ajax({
                        type: 'POST',
                        url: "{{ url_for('events.logo_upload', event_id=event.id) if event else url_for('events.create_event_logo_upload') }}",
                        data: {logo: e.target.result},
                        dataType: 'json'
                    }).done(function(data) {
                        console.log(data);
                        resetFormElement(input);
                        $("#logo-upload-label").html('<i class="fa fa-4x fa-file-image-o" aria-hidden="true"></i> <br> <h3>Select Logo</h3>');
                        $("#logo").val(data.logo);
                        $("#logo-upload-group").hide();
                        $("#logo-view-group").show().find("img").attr("src", e.target.result);
                    }).fail(function(data) {
                        alert("Something went wrong. Please try again.");
                    });
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        else {
            logError("No FileReader support");
        }

    });
    var loadingImage = '<img src="' + "{{ url_for('static', filename='img/loading.gif') }}" + '" style="width: 50px;"> <h3>Uploading</h3>';

    {% if event %}

    $("#remove-logo-btn").click(function () {
        $.ajax({
            type: 'DELETE',
            url: "{{ url_for('events.logo_upload', event_id=event.id) }}",
            dataType: 'json'
        }).done(function(data) {
            console.log(data);
            $("#logo-view-group").hide();
            $("#logo-upload-group").show();
            $("#logo").val('');
        }).fail(function(data) {
            alert("Something went wrong. Please try again.");
        });
    });
    {% else %}

    $("#remove-logo-btn").click(function () {
        $("#logo-view-group").hide();
        $("#logo-upload-group").show();
        $("#logo").val('');
    });
    {% endif %}
</script>
