
<!-- croppie Modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="cropper-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Crop your image</h4>
            </div>
            <div class="modal-body">
                <div id="upload-cropper">

                </div>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="save-crop" class="btn btn-success">Done</button>
                </div>

            </div>
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='admin/lib/Croppie/croppie.min.js') }}"></script>
<!-- end croppie -->


<script type="text/javascript">

var $uploadCropper = $('#upload-cropper');
var is_image_changed = false;

 $(document).ready(function () {


  $uploadCropper = $('#upload-cropper').croppie({
        viewport: {
            width: 340,
            height: 340,
            type: 'square'
        },
        boundary: {
            width: 460,
            height: 380
        }
    });


  $("#logo-upload").unbind("change").on('change', function () {
    var input = this;
    if (input.files && input.files[0]) {
        if (input.files[0].size > 10485760) {
            createSnackbar("Image must be less than 10 MB in size");
            resetFormElement(input);
        } else {
            var reader = new FileReader();
            reader.onload = function (e) {
                $("#cropper-modal").modal("show");
                $uploadCropper.croppie('bind', {
                    url: e.target.result
                });
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    else {
        logError("No FileReader support");
    }
  });


  // var loadingImage = '<img src="' + "{{ url_for('static', filename='img/loading.gif') }}" + '" style="width: 50px;"> <h3>Uploading</h3>';
    $("#save-crop").click(function () {
        $uploadCropper.croppie('result', {
            type: 'canvas',
            size: 'original'
        }).then(function (resp) {
            $('#cropper-modal').modal('hide')
            // $("#logo-upload-label").html(loadingImage);
            /* Disable Save Event buttons */
            // $(".save-event").prop("disabled", true);
            is_image_changed = true;
            $("#speaker-file-photo").val(resp);
            $("#logo-view-group").show().find("img").attr("src", resp);
            $("#logo-upload-group").hide();

            // $("#logo-upload-label").html('<i class="fa fa-4x fa-camera-retro" aria-hidden="true"></i><br><h3>Select Speaker Image</h3>');
            /* Enable Save Event buttons */
            // $(".save-event").prop("disabled", false);
        });
    });


    $("#remove-logo-btn").click(function () {
        is_image_changed = true;
        $("#logo-view-group").hide();
        $("#logo-upload-group").show();
        $("#speaker-file-photo").val('');
    });


    $('#cropper-modal').on('shown.bs.modal', function (e) {
        $uploadCropper.croppie('bind');
        resetFormElement($("#logo-upload"));
    });

});


function resetFormElement(e) {
    e = $(e);
    e.wrap('<form>').closest('form').get(0).reset();
    e.unwrap();
}


/**
 * Manual uploading Photo
 */

$('#session-create-form').submit(function(ev) {
    if (!is_image_changed){
        return true;
    }
    var resp = $('#speaker-file-photo').val();
    // ev.preventDefault(); // to stop the form from submitting
    // this.submit(); // If all the validations succeeded

    $.ajax({
        type: 'POST',
        url: "{{ url_for('event_speakers.photo_upload', event_id=event.id, speaker_id=speaker.id) }}",
        data: {photo: resp},
        dataType: 'json'
    }).done(function(data){
        console.log(data);
    });
});

</script>
