{% extends 'gentelella/admin/event/tickets/tickets_base.html' %}

{% set active_side_page = "discount_codes" %}


{% block head_css %}
    {{ super() }}
    <link rel="stylesheet"
          href="{{ url_for('static', filename='admin/lib/datatables.net-bs/css/dataTables.bootstrap.min.css') }}"/>

    <style type="text/css">

    </style>
{% endblock %}

{% block inner_content %}
    <h3 class="pull-left">Discount Codes </h3>
    <a class="btn btn-info pull-right" href="{{ url_for('event_ticket_sales.discount_codes_create', event_id=event.id) }}"><i class="fa fa-plus fa-fw"></i> Create a discount</a>
    <br>
    <br>
    <br>
    <div id="toolbar-holder" style="display: none;">
        <div class="btn-group pull-left" data-toggle="buttons">
            <label class="btn btn-default active btn-responsive">
                <input type="radio" name="show_state" autocomplete="off" value="all" checked> All
            </label>
            <label class="btn btn-default btn-responsive">
                <input type="radio" name="show_state" autocomplete="off" value="active"> Active
            </label>
            <label class="btn btn-default btn-responsive">
                <input type="radio" name="show_state" autocomplete="off" value="inactive"> In-Active
            </label>
        </div>
    </div>

    <table class="table with-datatable" width="100%">
        <thead>
        <tr>
            <th>#</th>
            <th>Discount Code</th>
            <th>Discount Per Ticket</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for discount_code in discount_codes %}
            <tr>
                <td></td>
                <td>{{ discount_code.code }}</td>
                <td>{{ discount_code.value }}</td>
                <td>{{ discount_code.valid_from | datetime }} to {{ discount_code.valid_till | datetime }}</td>
                <td>
                    {% if discount_code.is_active %}
                        <span class="label label-success">Active</span>
                    {% else %}
                        <span class="label label-warning">In-Active</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}

        </tbody>
    </table>
{% endblock %}
{% block tail_js %}
    {{ super() }}
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery/jquery.codezero.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/datatables.net/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/datatables.net-bs/js/dataTables.bootstrap.min.js') }}"></script>
    <script type="text/javascript">

        $.fn.dataTable.ext.search.push(
                function (settings, data, dataIndex) {
                    var user_option = $("input[name=show_state]:checked").val();
                    console.log(data);
                    var state = data[2].trim() || 'pending';
                    if (user_option === "all") {
                        return true;
                    } else if (user_option === state) {
                        return true;
                    }
                    return false;
                }
        );

        var table = $('.with-datatable').DataTable({
            "dom": '<"row"<"toolbar col-md-12"<"pull-right"l>>>tip',
            width: '100%',
            "columnDefs": [
                {
                    "searchable": false,
                    "orderable": false,
                    "targets": 0
                }
            ],
            "order": [[ 1, 'asc' ]],
            "scrollX": true
        });

        $("div.toolbar").prepend($("#toolbar-holder").html());

        $("input[name=show_state]").change(function () {
            table.draw();
        });

        table.on('draw', function () {
            $('[data-toggle="tooltip"]').tooltip();
        });

        table.on( 'order.dt search.dt', function () {
            table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                cell.innerHTML = i+1;
            } );
        }).draw();


    </script>
{% endblock %}

